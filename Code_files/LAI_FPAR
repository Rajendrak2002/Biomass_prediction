// Define the region of interest using the shapefile
var region = ee.FeatureCollection('projects/ee-rajendrakumar93/assets/acz_b_III-b_Region4');

// Define the MODIS ImageCollection (MOD15A3H for LAI and FPAR)
var modis = ee.ImageCollection("MODIS/061/MCD15A3H")
             .select(['Lai', 'Fpar'])  // Select LAI and FPAR bands
             .filterBounds(region)     // Filter the data to the region of interest
             .filterDate('2010-01-01', '2024-08-31');  // Date range

// Define a function to calculate and scale LAI and FPAR, then add month and year as properties
var scaleAndReduce = function(image) {
  var date = ee.Date(image.get('system:time_start'));
  var year = date.get('year');
  var month = date.get('month');
  
  // Scale LAI by 0.1 and FPAR by 0.01
  var scaledImage = image.select('Lai').multiply(0.1)
                         .addBands(image.select('Fpar').multiply(0.01))
                         .set('year', year)
                         .set('month', month);
  
  // Reduce the image to the mean value of the region
  var reduced = scaledImage.reduceRegion({
    reducer: ee.Reducer.mean(),
    geometry: region,
    scale: 500,  // 500m scale for MODIS data
    maxPixels: 1e13
  });
  
  return ee.Feature(null, reduced.set('year', year).set('month', month));
};

// Apply the scaling and reduction function over the ImageCollection
var results = modis.map(scaleAndReduce);

// Convert the results to a FeatureCollection and export to CSV
Export.table.toDrive({
  collection: ee.FeatureCollection(results),
  description: 'MODIS_LAI_FPAR_2010_2024',
  fileFormat: 'CSV',
  selectors: ['year', 'month', 'Lai', 'Fpar']
});
